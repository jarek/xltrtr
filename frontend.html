<!doctype html>
<meta charset="utf-8" />
<title>xltrtr</title>
<style type="text/css" media="screen,projection">
body {
    background: #fff;
    color: #333;

    font-family: sans-serif;
    font-weight: 200;
}
#translation {
    font-size: 200%;
}
</style>

<form id="transliteration-form" action="xltrtr.py">
<fieldset>
<legend>input</legend>
<p><input type="text" name="query" id="query">
<input id="submit-button" type="submit" value="submit">
</fieldset>
</form>

<fieldset>
<legend>output</legend>
<p><span id="translation">&nbsp;</span>
</fieldset>

<script type="text/javascript">
/*notmuchhere*/

function xhrJSON(url, callback) {
    xmlhttp = new XMLHttpRequest();
    xmlhttp.onload = function () {
        callback(JSON.parse(this.responseText));
    };
    xmlhttp.open("GET",url);
    xmlhttp.send();
}

function el(id) {
    return document.getElementById(id);
}

function transliterationRequested() {
    var text = el('query').value;

    if (oldText !== text) {
        if (text === '') {
            showResult('&nbsp;');
        } else {
            var form = el('transliteration-form');
            var url = form.action + '?query=' + text + '&ajax=1';
            result = xhrJSON(url, showResult);
        }
    }

    oldText = text;

    return false;
}

function showResult(result) {
    if (typeof result[0] === 'object') {
        // show the first result for now
        // TODO: handle ties, show scores detail, etc
        result = result[0]['output'];
    }

    el('translation').innerHTML = result;

    el('query').focus();
}

var oldText = "";
el('submit-button').onclick = transliterationRequested;
el('query').onkeyup = transliterationRequested;
el('query').focus();
</script>

